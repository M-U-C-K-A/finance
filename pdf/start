#!/bin/bash
# FinAnalytics PDF - DÃ©marrage simplifiÃ© et robuste

set -e

# Couleurs
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}ğŸš€ FinAnalytics PDF System${NC}"
echo ""

# Aller dans le dossier pdf
cd "$(dirname "$0")"

# VÃ©rifier Python
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}âŒ Python3 requis${NC}"
    exit 1
fi

# CrÃ©er venv si nÃ©cessaire
if [ ! -d "venv" ]; then
    echo -e "${YELLOW}ğŸ“¦ CrÃ©ation environnement Python...${NC}"
    python3 -m venv venv
fi

# Installer dÃ©pendances si nÃ©cessaire
if [ ! -f "venv/.installed" ]; then
    echo -e "${YELLOW}ğŸ“¦ Installation dÃ©pendances...${NC}"
    venv/bin/pip install -q yfinance pandas psycopg2-binary reportlab matplotlib pillow requests
    touch venv/.installed
fi

# Menu simple
echo -e "${YELLOW}Que voulez-vous faire ?${NC}"
echo "1) ğŸ§ª Tester le systÃ¨me"
echo "2) ğŸ“Š Scraper les donnÃ©es"
echo "3) ğŸ”„ Traiter les rapports"
echo "4) ğŸš€ Lancer le daemon complet"
echo "5) ğŸ“‹ Voir le statut"
echo "6) âŒ Quitter"
echo ""

read -p "Votre choix (1-6): " choice

case $choice in
    1)
        echo -e "${BLUE}ğŸ§ª Tests systÃ¨me...${NC}"
        venv/bin/python run.py test
        ;;
    2)
        echo -e "${BLUE}ğŸ“Š Scraping donnÃ©es...${NC}"
        venv/bin/python run.py scrape
        ;;
    3)
        echo -e "${BLUE}ğŸ”„ Traitement rapports...${NC}"
        venv/bin/python run.py process
        ;;
    4)
        echo -e "${BLUE}ğŸš€ Daemon complet...${NC}"
        echo -e "${YELLOW}Appuyez sur Ctrl+C pour arrÃªter${NC}"
        venv/bin/python run.py daemon
        ;;
    5)
        echo -e "${BLUE}ğŸ“‹ Statut systÃ¨me...${NC}"
        venv/bin/python run.py status
        ;;
    6)
        echo -e "${GREEN}ğŸ‘‹ Au revoir !${NC}"
        exit 0
        ;;
    *)
        echo -e "${RED}âŒ Choix invalide${NC}"
        exit 1
        ;;
esac