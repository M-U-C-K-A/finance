
---
title: "Analyse Graphique Avancée du CAC 40"
author: "Votre nom"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    number_sections: true
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyquant)
library(tidyverse)
library(lubridate)
library(plotly)
library(ggplot2)
library(timetk)
library(PerformanceAnalytics)
library(reshape2)
```

## 1. Chargement des données

```{r data}
tickers <- c("^FCHI", "OR.PA", "AI.PA", "AIR.PA", "MT.AS", "ATO.PA", "CS.PA", 
             "BNP.PA", "EN.PA", "CAP.PA", "CA.PA", "ACA.PA", "BN.PA", "KER.PA", 
             "ML.PA", "LR.PA", "MC.PA", "SGO.PA", "SAN.PA", "SU.PA", "GLE.PA", 
             "VIE.PA", "DG.PA", "VIV.PA", "FR.PA", "RMS.PA", "SAF.PA", "STLA.PA", 
             "STMPA.PA", "SW.PA", "HO.PA", "URW.AS", "WLN.PA", "EL.PA")

start_date <- "2020-01-01"
data_cac <- tq_get(tickers, from = start_date, get = "stock.prices")
```

---

## 2. Chandeliers sur l’indice CAC 40

```{r candlestick}
index_df <- data_cac %>% filter(symbol == "^FCHI")

plot_ly(data = index_df,
        x = ~date,
        type = "candlestick",
        open = ~open,
        close = ~close,
        high = ~high,
        low = ~low) %>%
  layout(title = "Graphique Chandeliers du CAC 40",
         xaxis = list(title = "Date"),
         yaxis = list(title = "Prix"))
```

---

## 3. Boxplot des rendements quotidiens

```{r boxplot}
returns_daily <- data_cac %>%
  group_by(symbol) %>%
  tq_transmute(select = adjusted,
               mutate_fun = periodReturn,
               period = "daily",
               col_rename = "returns")

ggplot(returns_daily, aes(x = symbol, y = returns)) +
  geom_boxplot(fill = "#FFDD57", outlier.color = "red") +
  theme_minimal() +
  coord_flip() +
  labs(title = "Distribution des rendements journaliers par action", x = "Société", y = "Rendement quotidien")
```

---

## 4. Heatmap des corrélations (statique et interactive)

```{r heatmap}
returns_monthly <- data_cac %>%
  group_by(symbol) %>%
  tq_transmute(select = adjusted,
               mutate_fun = periodReturn,
               period = "monthly",
               col_rename = "returns") %>%
  pivot_wider(names_from = symbol, values_from = returns) %>%
  drop_na()

cor_matrix <- cor(returns_monthly[,-1], use = "pairwise.complete.obs")

heatmaply::heatmaply_cor(cor_matrix,
                         xlab = "Tickers",
                         ylab = "Tickers",
                         main = "Heatmap interactive des corrélations",
                         k_col = 3,
                         k_row = 3)
```

---

## 5. Rendement annuel moyen par entreprise (sector plot)

```{r rendement-annual}
returns_yearly <- data_cac %>%
  group_by(symbol) %>%
  tq_transmute(select = adjusted,
               mutate_fun = periodReturn,
               period = "yearly",
               col_rename = "annual_return")

returns_avg <- returns_yearly %>%
  group_by(symbol) %>%
  summarise(mean_return = mean(annual_return, na.rm = TRUE)) %>%
  arrange(desc(mean_return))

ggplot(returns_avg, aes(x = reorder(symbol, mean_return), y = mean_return, fill = mean_return > 0)) +
  geom_col() +
  scale_fill_manual(values = c("TRUE" = "#27AE60", "FALSE" = "#C0392B")) +
  coord_flip() +
  labs(title = "Rendement annuel moyen par société", x = "Société", y = "Rendement moyen")
```

---

## 6. Nuage de points : Volatilité vs Rendement

```{r scatter-vol-ret}
perf_vol <- returns_daily %>%
  group_by(symbol) %>%
  summarise(volatility = sd(returns, na.rm = TRUE),
            avg_return = mean(returns, na.rm = TRUE))

ggplot(perf_vol, aes(x = volatility, y = avg_return, label = symbol)) +
  geom_point(color = "#2980B9", size = 3) +
  geom_text(nudge_y = 0.0015, size = 3) +
  theme_minimal() +
  labs(title = "Rendement vs Volatilité", x = "Volatilité", y = "Rendement moyen")
```

---

## 7. Graphique en secteurs : pondération fictive (exemple)

```{r pie}
# Exemple fictif : pondération égale
pond <- tibble(symbol = unique(data_cac$symbol),
               poids = rep(1/length(unique(data_cac$symbol)), length(unique(data_cac$symbol))))

ggplot(pond, aes(x = "", y = poids, fill = symbol)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  theme_void() +
  labs(title = "Répartition pondérée fictive du CAC 40")
```

---

## 8. Évolution de la volatilité dans le temps

```{r rolling-volatility}
rolling_vol <- returns_daily %>%
  group_by(symbol) %>%
  tq_mutate(select = returns,
            mutate_fun = rollapply,
            width = 30,
            FUN = sd,
            col_rename = "rolling_vol",
            align = "right") %>%
  filter(symbol %in% c("AIR.PA", "OR.PA", "BNP.PA"))

ggplot(rolling_vol, aes(x = date, y = rolling_vol, color = symbol)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Volatilité glissante (30 jours)", y = "Volatilité", x = "Date")
```

---

## 9. Conclusion

Ce rapport offre une **vue graphique avancée** du CAC 40 et de ses composantes. Grâce à une variété de graphiques interactifs et analytiques, nous avons exploré les dynamiques de volatilité, performance, corrélation et comportement temporel des titres.

---

## 10. Propositions futures

* Étendre l’analyse aux dividendes ou PER
* Ajouter des regroupements sectoriels
* Appliquer des modèles de prévision

```

---

Souhaitez-vous que je :

- Vous envoie le `.Rmd` en fichier ?
- Génére la version **PDF** ou **HTML** finale pour vous ?
- Adapte le style pour un usage universitaire, entreprise ou présentation ?

Je peux aussi l’étendre à d'autres indices ou inclure des analyses machine learning si vous voulez aller plus loin.
```
